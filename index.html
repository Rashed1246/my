<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>موقعي الشخصي — لوحة تحكم</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #9aa4b2;
      --glass: rgba(255, 255, 255, 0.03);
      --radius: 12px;
      --transition: 180ms;
      --font: 'Segoe UI', Tahoma, system-ui, "Noto Naskh Arabic", sans-serif;
    }

    body.light {
      --bg: #f5f7fa;
      --card: #fff;
      --accent: #ef4444;
      --muted: #444;
      --glass: rgba(0, 0, 0, 0.06);
      background: linear-gradient(180deg, #fdfdfd, #f0f0f0);
      color: #111;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: #e6eef6;
      font-family: var(--font);
    }

    .app {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 14px;
      min-height: 100vh;
      padding: 14px;
    }

    header {
      grid-column: 1/-1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--glass);
      border-radius: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .logo {
      width: 44px;
      height: 44px;
      background: linear-gradient(90deg, var(--accent), #7c3aed);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
    }

    .brand h1 {
      font-size: 16px;
      margin: 0;
    }

    .brand p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    main {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      padding: 12px;
      border-radius: 12px;
      overflow: auto;
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    button {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.03);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
      min-width: 110px;
      text-align: center;
    }

    button.primary {
      background: linear-gradient(90deg, var(--accent), #7c3aed);
      color: #021022;
      font-weight: 700;
    }

    .editor {
      min-height: 50vh;
      padding: 12px;
      background: #071526;
      border-radius: 10px;
      outline: none;
      border: 1px solid rgba(255, 255, 255, 0.02);
      font-size: 16px;
      line-height: 1.6;
      overflow: auto;
    }

    aside {
      background: linear-gradient(180deg, #071226, #071320);
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: stretch;
      overflow: auto;
    }

    .card {
      background: rgba(255, 255, 255, 0.02);
      padding: 10px;
      border-radius: 8px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      background: transparent;
      color: inherit;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .switch {
      width: 46px;
      height: 26px;
      background: #0b1220;
      border-radius: 999px;
      position: relative;
      padding: 3px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .knob {
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: left var(--transition);
    }

    .switch.on {
      background: linear-gradient(90deg, #06b6d4, #7c3aed);
    }

    .switch.on .knob {
      left: 25px;
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
    }

    .stat {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .stat .value {
      font-size: 18px;
      color: #e6f8fb;
      font-weight: 700;
    }

    footer {
      grid-column: 1/-1;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      padding-top: 6px;
    }

    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      background: #021526;
      color: #dff7fb;
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(2, 6, 23, 0.6);
      display: none;
      z-index: 9999;
    }

    .header-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 13px;
      color: var(--muted);
    }

    #historyModal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    #historyModal .panel {
      width: min(920px, 100%);
      max-height: 80vh;
      background: var(--card);
      border-radius: 10px;
      padding: 12px;
      overflow: auto;
    }

    #historyModal h3 {
      margin: 0 0 10px 0;
      color: #fff;
    }

    .history-item {
      padding: 8px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.02);
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .history-item .meta {
      font-size: 12px;
      color: var(--muted);
      max-width: 70%;
    }

    .history-actions {
      display: flex;
      gap: 8px;
    }

    @media(max-width:880px) {
      .app {
        grid-template-columns: 1fr;
        padding: 10px;
        min-height: 100vh;
      }

      aside {
        order: 2;
        max-height: 300px;
      }

      main {
        order: 1;
      }

      .controls button {
        flex: 1 1 45%;
        min-width: auto;
      }

      .editor {
        min-height: 40vh;
        font-size: 15px;
      }

      header {
        justify-content: center;
      }

      #historyModal .panel {
        padding: 10px;
      }
    }

    /* شاشة الترحيب */
    #welcomeScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #06b6d4, #7c3aed);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      z-index: 99999;
      animation: fadeOut 10s forwards;
      opacity: 1;
    }

    #welcomeScreen h1 {
      font-size: 48px;
      margin: 0;
      animation: slideDown 2s ease;
    }

    #welcomeScreen p {
      font-size: 20px;
      margin-top: 12px;
      animation: fadeIn 3s ease;
    }

    @keyframes slideDown {
      0% {
        transform: translateY(-50px);
        opacity: 0;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @keyframes fadeOut {

      0%,
      90% {
        opacity: 1;
      }

      100% {
        opacity: 0;
        display: none;
      }
    }
  </style>
</head>

<body>
  <div id="welcomeScreen">
    <h1 id="welcomeTitle">مرحباً بك في موقعي</h1>
    <p>سيتم فتح الموقع تلقائياً خلال 10 ثواني</p>
  </div>

  <div class="app" role="application" style="display:none;">
    <header>
      <div class="brand">
        <div class="logo" id="logoTxt">م</div>
        <div>
          <h1 contenteditable="true" id="siteName">موقعي الشخصي</h1>
          <p id="siteTag">لوحة تحكم قابلة للتعديل</p>
        </div>
      </div>
      <div class="header-meta">
        <div id="clock">--:--:--</div>
        <div id="date">--/--/----</div>
      </div>
    </header>

    <main>
      <div class="controls" id="topControls">
        <button class="primary" id="saveBtn">حفظ (محلي)</button>
        <button id="downloadBtn">تنزيل HTML</button>
        <button id="clearBtn">مسح المحتوى</button>
        <button id="timeBtn">أظهر التاريخ والوقت</button>
        <button id="locBtn">احصل على الموقع</button>
        <button id="themeBtn">تبديل ليل/نهار</button>
        <button id="newPageBtn">صفحة جديدة</button>
        <button id="historyBtn">المحفوظات</button>
      </div>
      <div class="editor" id="editor" contenteditable="true" aria-label="محرر النص">
        اكتب هنا. هذا محرر نص كامل، يمكنك تغيير النص، الضغط على حفظ ثم إعادة تحميل الصفحة لرؤية البيانات المحفوظة.
      </div>
      <div class="controls" style="margin-top:12px;">
        <label style="min-width:120px">حجم الخط:
          <select id="fontSize" style="margin-left:8px">
            <option value="14px">14px</option>
            <option value="16px" selected>16px</option>
            <option value="18px">18px</option>
            <option value="20px">20px</option>
            <option value="22px">22px</option>
          </select>
        </label>
        <label style="min-width:180px">نوع الخط:
          <select id="fontFamily" style="margin-left:8px">
            <option value="'Segoe UI',Tahoma,system-ui">Segoe UI</option>
            <option value="'Tahoma',sans-serif">Tahoma</option>
            <option value="'Noto Naskh Arabic',serif" selected>Noto Naskh Arabic</option>
            <option value="'Cairo',sans-serif">Cairo</option>
            <option value="'Courier New',monospace">Courier New</option>
          </select>
        </label>
      </div>
    </main>

    <aside>
      <div class="card">
        <label>اسم الموقع (قابل للتعديل)</label>
        <input type="text" id="siteInput" placeholder="اكتب اسم الموقع" />
        <small>اضغط حفظ ليتم تخزينه محلياً</small>
      </div>

      <div class="card">
        <div class="row">
          <label>حالة الموقع</label>
          <div class="toggle">
            <div id="statusText" class="meta">غير معروف</div>
            <div id="switch" class="switch" role="switch" aria-checked="false">
              <div class="knob"></div>
            </div>
          </div>
        </div>
        <small id="statusInfo">لم يتم تحديد الحالة.</small>
      </div>

      <div class="card">
        <div class="row">
          <label>معلومات الموقع</label>
          <div>
            <div class="meta" id="coords">خط العرض: - , خط الطول: -</div>
            <div class="meta" id="accuracy"></div>
          </div>
        </div>
        <small id="locNote">اضغط "احصل على الموقع" لاختبار واجهة الموقع الجغرافي.</small>
      </div>

      <div class="card">
        <button id="voiceBtn" class="primary">الإملاء الصوتي</button>
        <small id="voiceStatus">اضغط لتفعيل الكتابة بالصوت</small>
      </div>

      <div class="card">
        <label>وصف الموقع:</label>
        <textarea id="siteDesc" placeholder="اكتب وصف الموقع هنا..."></textarea>
      </div>

      <div class="card stat">
        <div class="row"><label>حجم النص المحفوظ</label>
          <div class="value" id="len">0</div>
        </div>
        <div class="row"><label>آخر حفظ</label>
          <div class="meta" id="lastSaved">لم يحفظ بعد</div>
        </div>
        <div class="row"><label>دليل الاستخدام</label>
          <div class="meta" id="usageGuide">اكتب النص واحفظه، يمكن تنزيله لاحقاً</div>
        </div>
      </div>
    </aside>

    <div id="historyModal" aria-hidden="true">
      <div class="panel">
        <h3>المحفوظات <button id="closeHistory" style="float:left">إغلاق</button></h3>
        <div id="historyList"></div>
      </div>
    </div>
    <div class="toast" id="toast">تم</div>
    <footer>نسخة نهائية — جاهزة للنشر</footer>

    <script>
      const editor = document.getElementById('editor');
      const saveBtn = document.getElementById('saveBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const clearBtn = document.getElementById('clearBtn');
      const timeBtn = document.getElementById('timeBtn');
      const locBtn = document.getElementById('locBtn');
      const themeBtn = document.getElementById('themeBtn');
      const newPageBtn = document.getElementById('newPageBtn');
      const historyBtn = document.getElementById('historyBtn');
      const voiceBtn = document.getElementById('voiceBtn');
      const toast = document.getElementById('toast');
      const lenEl = document.getElementById('len');
      const lastSaved = document.getElementById('lastSaved');
      const siteInput = document.getElementById('siteInput');
      const siteName = document.getElementById('siteName');
      const logoTxt = document.getElementById('logoTxt');
      const clock = document.getElementById('clock');
      const dateBox = document.getElementById('date');
      const coords = document.getElementById('coords');
      const accuracy = document.getElementById('accuracy');
      const statusText = document.getElementById('statusText');
      const statusInfo = document.getElementById('statusInfo');
      const sw = document.getElementById('switch');
      const fontSize = document.getElementById('fontSize');
      const fontFamily = document.getElementById('fontFamily');
      const historyModal = document.getElementById('historyModal');
      const historyListEl = document.getElementById('historyList');
      const closeHistory = document.getElementById('closeHistory');
      const voiceStatus = document.getElementById('voiceStatus');
      const siteDesc = document.getElementById('siteDesc');

      let userKey = 'app:user:' + (localStorage.getItem('userId') || Date.now());
      localStorage.setItem('userId', userKey.split(':')[2]);
      let historyList = JSON.parse(localStorage.getItem(userKey + ':history') || '[]');

      function showToast(txt, ms = 1600) { toast.textContent = txt; toast.style.display = 'block'; setTimeout(() => toast.style.display = 'none', ms); }
      function updateLen() { lenEl.textContent = editor.textContent.trim().length; }
      function addHistory(data) { historyList.push({ time: new Date().toLocaleString(), content: data }); localStorage.setItem(userKey + ':history', JSON.stringify(historyList)); }

      function saveContent() {
        localStorage.setItem(userKey, editor.innerHTML);
        localStorage.setItem(userKey + ':desc', siteDesc.value);
        lastSaved.textContent = new Date().toLocaleString();
        addHistory(editor.innerHTML);
        showToast('تم الحفظ');
        updateLen();
      }

      function loadContent() {
        const data = localStorage.getItem(userKey);
        if (data) editor.innerHTML = data;
        const desc = localStorage.getItem(userKey + ':desc');
        if (desc) siteDesc.value = desc;
        updateLen();
      }

      saveBtn.addEventListener('click', saveContent);
      downloadBtn.addEventListener('click', () => {
        const blob = new Blob([editor.innerHTML], { type: 'text/html;charset=utf-8' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'page.html';
        a.click();
      });
      clearBtn.addEventListener('click', () => { editor.innerHTML = ''; updateLen(); showToast('تم المسح'); });
      newPageBtn.addEventListener('click', () => { editor.innerHTML = ''; updateLen(); });
      themeBtn.addEventListener('click', () => { document.body.classList.toggle('light'); });
      siteInput.addEventListener('input', () => { siteName.textContent = siteInput.value; localStorage.setItem('siteName', siteInput.value); });
      sw.addEventListener('click', () => { sw.classList.toggle('on'); statusText.textContent = sw.classList.contains('on') ? 'نشط' : 'متوقف'; statusInfo.textContent = sw.classList.contains('on') ? 'الموقع يعمل' : 'الموقع متوقف'; sw.setAttribute('aria-checked', sw.classList.contains('on')); });

      historyBtn.addEventListener('click', () => {
        historyListEl.innerHTML = '';
        historyList.slice().reverse().forEach((h, i) => {
          const item = document.createElement('div'); item.className = 'history-item';
          item.innerHTML = `<div class="meta">${h.time} - ${h.content.substring(0, 50)}...</div>
            <div class="history-actions">
              <button onclick="editor.innerHTML=historyList[${historyList.length - 1 - i}].content;updateLen()">عرض</button>
              <button onclick="historyList.splice(${historyList.length - 1 - i},1);localStorage.setItem('${userKey}:history',JSON.stringify(historyList));this.parentElement.parentElement.remove()">حذف</button>
            </div>`;
          historyListEl.appendChild(item);
        });
        historyModal.style.display = 'flex';
      });

      closeHistory.addEventListener('click', () => { historyModal.style.display = 'none'; });

      function updateClock() { const d = new Date(); clock.textContent = d.toLocaleTimeString(); dateBox.textContent = d.toLocaleDateString(); }
      setInterval(updateClock, 1000); updateClock();
      loadContent(); siteInput.value = localStorage.getItem('siteName') || 'موقعي الشخصي'; siteName.textContent = siteInput.value;

      locBtn.addEventListener('click', () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            coords.textContent = `خط العرض: ${pos.coords.latitude.toFixed(4)} , خط الطول: ${pos.coords.longitude.toFixed(4)}`;
            accuracy.textContent = `دقة: ${pos.coords.accuracy} متر`;
          }, err => { coords.textContent = 'تعذر الحصول على الموقع'; accuracy.textContent = ''; });
        } else { coords.textContent = 'جهازك لا يدعم تحديد الموقع'; }
      });

      // الإملاء الصوتي
      let recognition;
      voiceBtn.addEventListener('click', () => {
        if (!('webkitSpeechRecognition' in window)) { showToast('المتصفح لا يدعم الإملاء الصوتي'); return; }
        if (!recognition) {
          recognition = new webkitSpeechRecognition();
          recognition.lang = 'ar-AR';
          recognition.continuous = true;
          recognition.interimResults = true;
          recognition.onresult = function (event) {
            let transcript = '';
            for (let i = event.resultIndex; i < event.results.length; ++i) {
              transcript += event.results[i][0].transcript;
            }
            editor.innerHTML += transcript;
            updateLen();
          };
          recognition.onend = () => { voiceStatus.textContent = 'الإملاء متوقف'; recognition = null; };
          recognition.start();
          voiceStatus.textContent = 'الإملاء جاري...';
        } else {
          recognition.stop();
          recognition = null;
          voiceStatus.textContent = 'الإملاء متوقف';
        }
      });

      // شاشة الترحيب
      const welcomeScreen = document.getElementById('welcomeScreen');
      setTimeout(() => { welcomeScreen.style.display = 'none'; document.querySelector('.app').style.display = 'grid'; }, 10000);
    </script>
  </div>
</body>

</html>
