<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>موقعي الشخصي — لوحة تحكم</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #9aa4b2;
      --glass: rgba(238, 233, 233, 0.03);
      --radius: 12px;
      --transition: 180ms;
      --font: 'Segoe UI', Tahoma, system-ui, "Noto Naskh Arabic", sans-serif;
    }

    body.light {
      --bg: #f5f7fa;
      --card: #fff;
      --accent: #ef4444;
      --muted: #444;
      --glass: rgba(196, 193, 193, 0.06);
      background: linear-gradient(180deg, #fdfdfd, #f0f0f0);
      color: #000000;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: #e6eef6;
      font-family: var(--font);
    }

    .app {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 14px;
      min-height: 100vh;
      padding: 14px;
    }

    header {
      grid-column: 1/-1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--glass);
      border-radius: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .logo {
      width: 44px;
      height: 44px;
      background: linear-gradient(90deg, var(--accent), #7c3aed);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
    }

    .brand h1 {
      font-size: 16px;
      margin: 0;
    }

    .brand p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    main {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      padding: 12px;
      border-radius: 12px;
      overflow: auto;
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    button {
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.03);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform var(--transition), box-shadow var(--transition);
      min-width: 110px;
      text-align: center;
    }

    button.primary {
      background: linear-gradient(90deg, var(--accent), #7c3aed);
      color: #021022;
      font-weight: 700;
    }

    .editor {
      min-height: 50vh;
      padding: 12px;
      background: #071526;
      border-radius: 10px;
      outline: none;
      border: 1px solid rgba(255, 255, 255, 0.02);
      font-size: 16px;
      line-height: 1.6;
      overflow: auto;
    }

    aside {
      background: linear-gradient(180deg, #071226, #071320);
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: stretch;
      overflow: auto;
    }

    .card {
      background: rgba(255, 255, 255, 0.02);
      padding: 10px;
      border-radius: 8px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      background: transparent;
      color: inherit;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .switch {
      width: 46px;
      height: 26px;
      background: #0b1220;
      border-radius: 999px;
      position: relative;
      padding: 3px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.02);
    }

    .knob {
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px;
      transition: left var(--transition);
    }

    .switch.on {
      background: linear-gradient(90deg, #06b6d4, #7c3aed);
    }

    .switch.on .knob {
      left: 25px;
    }

    .meta {
      font-size: 13px;
      color: var(--muted);
    }

    .stat {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    footer {
      grid-column: 1/-1;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      padding-top: 6px;
    }

    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      background: #021526;
      color: #dff7fb;
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(2, 6, 23, 0.6);
      display: none;
      z-index: 9999;
    }

    .header-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 13px;
      color: var(--muted);
    }

    #historyModal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }

    #historyModal .panel {
      width: min(920px, 100%);
      max-height: 80vh;
      background: var(--card);
      border-radius: 10px;
      padding: 12px;
      overflow: auto;
    }

    #historyModal h3 {
      margin: 0 0 10px 0;
      color: #fff;
    }

    .history-item {
      padding: 8px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.02);
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .history-item .meta {
      font-size: 12px;
      color: var(--muted);
      max-width: 70%;
    }

    .history-actions {
      display: flex;
      gap: 8px;
    }

    input[type="file"] {
      display: none;
    }

    .custom-file-upload {
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: inline-block;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 10px;
      background: var(--card);
      color: var(--muted);
    }

    @media(max-width:880px) {
      .app {
        grid-template-columns: 1fr;
        padding: 10px;
        min-height: 100vh;
      }

      aside {
        order: 2;
        max-height: 300px;
      }

      main {
        order: 1;
      }

      .controls button {
        flex: 1 1 45%;
        min-width: auto;
      }

      .editor {
        min-height: 40vh;
        font-size: 15px;
      }

      header {
        justify-content: center;
      }

      #historyModal .panel {
        padding: 10px;
      }
    }

    /* شاشة الترحيب */
    #welcomeScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #06b6d4, #7c3aed);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      z-index: 99999;
      opacity: 1;
    }

    #welcomeScreen h1 {
      font-size: 48px;
      margin: 0;
      animation: slideDown 2s ease;
    }

    #welcomeScreen p {
      font-size: 20px;
      margin-top: 12px;
      animation: fadeIn 3s ease;
    }

    @keyframes slideDown {
      0% {
        transform: translateY(-50px);
        opacity: 0;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div id="welcomeScreen">
    <h1 id="welcomeTitle">مرحباً بك في موقعي</h1>
    <p>سيتم فتح الموقع تلقائياً خلال 10 ثواني</p>
  </div>

  <div class="app" role="application" style="display:none;">
    <header>
      <div class="brand">
        <div class="logo" id="logoTxt">م</div>
        <div>
          <h1 id="siteName">موقعي الشخصي</h1>
          <p id="siteTag">لوحة تحكم قابلة للتعديل</p>
        </div>
      </div>
      <div class="header-meta">
        <div id="clock">--:--:--</div>
        <div id="date">--/--/----</div>
      </div>
    </header>

    <main>
      <div class="controls" id="topControls">
        <button class="primary" id="saveBtn">حفظ (محلي)</button>
        <button id="downloadBtn">تنزيل HTML</button>
        <button id="clearBtn">مسح المحتوى</button>
        <button id="timeBtn">أظهر التاريخ والوقت</button>
        <button id="locBtn">احصل على الموقع</button>
        <button id="themeBtn">تبديل ليل/نهار</button>
        <button id="newPageBtn">صفحة جديدة</button>
        <button id="historyBtn">المحفوظات</button>
        <label class="custom-file-upload">
          <input type="file" id="fileUpload" accept="image/*" />
          رفع صورة
        </label>
      </div>
      <div class="editor" id="editor" contenteditable="true" aria-label="محرر النص">
        اكتب هنا. هذا محرر نص كامل، يمكنك تغيير النص، الضغط على حفظ ثم إعادة تحميل الصفحة لرؤية البيانات المحفوظة.
      </div>
      <div class="controls" style="margin-top:12px;">
        <label style="min-width:120px">حجم الخط:
          <select id="fontSize" style="margin-left:8px">
            <option value="14px">14px</option>
            <option value="16px" selected>16px</option>
            <option value="18px">18px</option>
            <option value="20px">20px</option>
            <option value="22px">22px</option>
          </select>
        </label>
        <label style="min-width:180px">نوع الخط:
          <select id="fontFamily" style="margin-left:8px">
            <option value="'Segoe UI',Tahoma,system-ui">Segoe UI</option>
            <option value="'Tahoma',sans-serif">Tahoma</option>
            <option value="'Noto Naskh Arabic',serif" selected>Noto Naskh Arabic</option>
            <option value="'Cairo',sans-serif">Cairo</option>
            <option value="'Courier New',monospace">Courier New</option>
          </select>
        </label>
      </div>
    </main>

    <aside>
      <div class="card">
        <label>اسم الموقع (قابل للتعديل)</label>
        <input type="text" id="siteInput" placeholder="اكتب اسم الموقع" />
        <small>اضغط حفظ ليتم تخزينه محلياً</small>
      </div>

      <div class="card">
        <div class="row">
          <label>حالة الموقع</label>
          <div class="toggle">
            <div id="statusText" class="meta">غير مفعل</div>
            <div id="switch" class="switch" role="switch" aria-checked="false">
              <div class="knob"></div>
            </div>
          </div>
        </div>
        <small id="statusInfo">الحالة مفعلة/غير مفعلة</small>
      </div>

      <div class="card">
        <div class="row">
          <label>معلومات الموقع</label>
          <div>
            <div class="meta" id="coords">خط العرض: - , خط الطول: -</div>
            <div class="meta" id="accuracy"></div>
          </div>
        </div>
        <small id="locNote">اضغط "احصل على الموقع" لاختبار الموقع الجغرافي.</small>
      </div>

      <div class="card">
        <button id="voiceBtn" class="primary">الإملاء الصوتي</button>
        <small id="voiceStatus">اضغط لتفعيل الكتابة بالصوت</small>
      </div>

      <div class="card">
        <label>وصف الموقع:</label>
        <textarea id="siteDesc" readonly>
هذا موقع شخصي لإدارة المحتوى النصي، رفع الصور، متابعة حالة الموقع والتاريخ، مع دعم الوضع الليلي والإملاء الصوتي. سهل الاستخدام ويتيح حفظ البيانات محلياً وتنزيلها على شكل صفحة HTML.
        </textarea>
      </div>

      <div class="card stat">
        <div class="row"><label>حجم النص المحفوظ</label>
          <div class="value" id="len">0</div>
        </div>
        <div class="row"><label>آخر حفظ</label>
          <div class="meta" id="lastSaved">لم يحفظ بعد</div>
        </div>
        <div class="row"><label>دليل الاستخدام</label>
          <div class="meta" id="usageGuide">اكتب النص واحفظه، يمكن تنزيله لاحقاً</div>
        </div>
      </div>
    </aside>

    <div id="historyModal" aria-hidden="true">
      <div class="panel">
        <h3>المحفوظات <button id="closeHistory" style="float:left">إغلاق</button></h3>
        <div id="historyList"></div>
      </div>
    </div>
    <div class="toast" id="toast">تم</div>
    <footer>نسخة نهائية — جاهزة للنشر</footer>

    <script>
      const editor = document.getElementById('editor');
      const saveBtn = document.getElementById('saveBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const clearBtn = document.getElementById('clearBtn');
      const timeBtn = document.getElementById('timeBtn');
      const locBtn = document.getElementById('locBtn');
      const themeBtn = document.getElementById('themeBtn');
      const newPageBtn = document.getElementById('newPageBtn');
      const historyBtn = document.getElementById('historyBtn');
      const voiceBtn = document.getElementById('voiceBtn');
      const toast = document.getElementById('toast');
      const lenEl = document.getElementById('len');
      const lastSaved = document.getElementById('lastSaved');
      const siteInput = document.getElementById('siteInput');
      const siteName = document.getElementById('siteName');
      const logoTxt = document.getElementById('logoTxt');
      const clock = document.getElementById('clock');
      const dateBox = document.getElementById('date');
      const coords = document.getElementById('coords');
      const accuracy = document.getElementById('accuracy');
      const statusText = document.getElementById('statusText');
      const statusInfo = document.getElementById('statusInfo');
      const sw = document.getElementById('switch');
      const welcomeScreen = document.getElementById('welcomeScreen');
      const appContainer = document.querySelector('.app');
      const fontSize = document.getElementById('fontSize');
      const fontFamily = document.getElementById('fontFamily');

      const historyModal = document.getElementById('historyModal');
      const historyList = document.getElementById('historyList');
      const closeHistory = document.getElementById('closeHistory');

      // فتح الموقع بعد الترحيب
      let countdown = 10;
      const countdownEl = welcomeScreen.querySelector('p');
      const interval = setInterval(() => {
        countdown--;
        countdownEl.textContent = `سيتم فتح الموقع تلقائياً خلال ${countdown} ثواني`;
        if (countdown <= 0) {
          clearInterval(interval);
          welcomeScreen.style.display = 'none';
          appContainer.style.display = 'grid';
        }
      }, 1000);

      // تحميل النص من التخزين المحلي
      editor.innerHTML = localStorage.getItem('content') || editor.innerHTML;
      lenEl.textContent = editor.innerText.length;
      siteInput.value = localStorage.getItem('siteName') || '';
      if (siteInput.value) siteName.textContent = siteInput.value;

      // حفظ التغييرات التلقائي
      editor.addEventListener('input', () => {
        localStorage.setItem('content', editor.innerHTML);
        lenEl.textContent = editor.innerText.length;
        const now = new Date();
        lastSaved.textContent = now.toLocaleString();
        saveHistory(editor.innerHTML);
      });

      // حفظ يدوي
      saveBtn.onclick = () => {
        localStorage.setItem('content', editor.innerHTML);
        const now = new Date();
        lastSaved.textContent = now.toLocaleString();
        showToast("تم الحفظ محلياً");
      }

      // تحميل HTML
      downloadBtn.onclick = () => {
        const blob = new Blob([editor.innerHTML], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "page.html";
        a.click();
        URL.revokeObjectURL(url);
        showToast("تم تنزيل HTML");
      }

      // مسح المحتوى
      clearBtn.onclick = () => {
        if (confirm("هل تريد مسح كل المحتوى؟")) {
          editor.innerHTML = '';
          localStorage.setItem('content', '');
          showToast("تم المسح");
        }
      }

      // الوقت والتاريخ
      function updateTime() {
        const now = new Date();
        clock.textContent = now.toLocaleTimeString();
        dateBox.textContent = now.toLocaleDateString();
      }
      setInterval(updateTime, 1000);
      updateTime();

      // تبديل الوضع الليلي
      themeBtn.onclick = () => {
        document.body.classList.toggle('light');
      }

      // صفحة جديدة
      newPageBtn.onclick = () => {
        editor.innerHTML = '';
        lenEl.textContent = '0';
        showToast("صفحة جديدة");
      }

      // موقع المستخدم
      locBtn.onclick = () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            coords.textContent = `خط العرض: ${pos.coords.latitude}, خط الطول: ${pos.coords.longitude}`;
            accuracy.textContent = `دقة الموقع: ${pos.coords.accuracy} متر`;
          }, err => {
            coords.textContent = `خطأ في الحصول على الموقع`;
          });
        } else {
          coords.textContent = "المتصفح لا يدعم الموقع";
        }
      }

      // تبديل الحالة
      sw.onclick = () => {
        sw.classList.toggle('on');
        statusText.textContent = sw.classList.contains('on') ? 'مفعل' : 'غير مفعل';
        statusInfo.textContent = sw.classList.contains('on') ? 'الحالة مفعلة' : 'الحالة غير مفعلة';
      }

      // حفظ اسم الموقع
      siteInput.oninput = () => {
        siteName.textContent = siteInput.value;
        logoTxt.textContent = siteInput.value[0] || 'م';
        localStorage.setItem('siteName', siteInput.value);
      }

      // الإملاء الصوتي
      let recognition;
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.lang = 'ar-SA';
        recognition.onresult = (e) => {
          editor.innerHTML += e.results[e.results.length - 1][0].transcript + " ";
          editor.scrollTop = editor.scrollHeight;
          lenEl.textContent = editor.innerText.length;
          saveHistory(editor.innerHTML);
        }
        recognition.onerror = () => { showToast("حدث خطأ في الإملاء الصوتي") };
      } else {
        voiceBtn.disabled = true;
        voiceBtn.textContent = "الإملاء غير مدعوم";
      }
      voiceBtn.onclick = () => {
        if (recognition) recognition.start();
      }

      // التوست
      function showToast(msg) {
        toast.textContent = msg;
        toast.style.display = 'block';
        setTimeout(() => { toast.style.display = 'none'; }, 2500);
      }

      // المحفوظات
      function saveHistory(text) {
        let history = JSON.parse(localStorage.getItem('history') || '[]');
        history.unshift({ text, date: new Date().toLocaleString() });
        if (history.length > 20) history.pop();
        localStorage.setItem('history', JSON.stringify(history));
      }

      historyBtn.onclick = () => {
        historyList.innerHTML = '';

        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('content-')) {  // استخدم المفتاح الديناميكي فقط
            const value = localStorage.getItem(key) || ''; // تأكد أنه ليس null
            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `
        <div class="meta">${value.substring(0, 100)}...</div>
        <div class="history-actions">
          <button onclick="loadHistory('${key}')">تحميل</button>
          <button onclick="deleteHistory('${key}', this)">حذف</button>
        </div>`;
            historyList.appendChild(div);
          }
        }

        historyModal.style.display = 'flex';
      }

      closeHistory.onclick = () => { historyModal.style.display = 'none'; }

      function loadHistory(index) {
        let history = JSON.parse(localStorage.getItem('history') || '[]');
        if (history[index]) {
          editor.innerHTML = history[index].text;
          lenEl.textContent = editor.innerText.length;
          showToast("تم تحميل النسخة");
        }
      }

      function deleteHistory(index, btn) {
        let history = JSON.parse(localStorage.getItem('history') || '[]');
        history.splice(index, 1);
        localStorage.setItem('history', JSON.stringify(history));
        btn.closest('.history-item').remove();
        showToast("تم حذف النسخة");
      }

      // تغيير حجم الخط ونوعه
      fontSize.onchange = () => { editor.style.fontSize = fontSize.value; }
      fontFamily.onchange = () => { editor.style.fontFamily = fontFamily.value; }

      // رفع الصور
      const fileUpload = document.getElementById('fileUpload');
      fileUpload.onchange = (e) => {
        const file = e.target.files[0];
        if (file && file.type.startsWith('image')) {
          const reader = new FileReader();
          reader.onload = function (evt) {
            const img = document.createElement('img');
            img.src = evt.target.result;
            img.style.maxWidth = '100%';
            editor.appendChild(img);
            saveHistory(editor.innerHTML);
            showToast("تم رفع الصورة");
          }
          reader.readAsDataURL(file);
        }
      }

    </script>
  </div>
</body>

</html>
